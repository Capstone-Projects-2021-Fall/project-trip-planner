-- This is auto-generated, changes here will not be reflected on the database. Do not edit this file.

CREATE DATABASE  IF NOT EXISTS `database` /*!40100 DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci */ /*!80016 DEFAULT ENCRYPTION='N' */;
USE `database`;
-- MySQL dump 10.13  Distrib 8.0.26, for Win64 (x86_64)
--
-- Host: tripplannerdb.cmmyrzbau9mp.us-west-2.rds.amazonaws.com    Database: database
-- ------------------------------------------------------
-- Server version	8.0.23

/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */;
/*!40101 SET @OLD_CHARACTER_SET_RESULTS=@@CHARACTER_SET_RESULTS */;
/*!40101 SET @OLD_COLLATION_CONNECTION=@@COLLATION_CONNECTION */;
/*!50503 SET NAMES utf8 */;
/*!40103 SET @OLD_TIME_ZONE=@@TIME_ZONE */;
/*!40103 SET TIME_ZONE='+00:00' */;
/*!40014 SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0 */;
/*!40014 SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0 */;
/*!40101 SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='NO_AUTO_VALUE_ON_ZERO' */;
/*!40111 SET @OLD_SQL_NOTES=@@SQL_NOTES, SQL_NOTES=0 */;
SET @MYSQLDUMP_TEMP_LOG_BIN = @@SESSION.SQL_LOG_BIN;
SET @@SESSION.SQL_LOG_BIN= 0;

--
-- GTID state at the beginning of the backup 
--

SET @@GLOBAL.GTID_PURGED=/*!80000 '+'*/ '';

--
-- Temporary view structure for view `DefaultUIView`
--

DROP TABLE IF EXISTS `DefaultUIView`;
/*!50001 DROP VIEW IF EXISTS `DefaultUIView`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `DefaultUIView` AS SELECT 
 1 AS `ItineraryName`,
 1 AS `StartDate`,
 1 AS `EndDate`,
 1 AS `CurrentDay`,
 1 AS `ActivityName`,
 1 AS `StartTime`,
 1 AS `EndTime`*/;
SET character_set_client = @saved_cs_client;

--
-- Table structure for table `GoogleLogin`
--

DROP TABLE IF EXISTS `GoogleLogin`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `GoogleLogin` (
  `idGoogleLogin` int NOT NULL AUTO_INCREMENT,
  `GoogleLoginToken` varchar(45) DEFAULT NULL COMMENT 'some way to verify identity via google system. likely not a varchar.',
  PRIMARY KEY (`idGoogleLogin`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci COMMENT='Temporary Table for Google login info, not useful yet because i have no idea what the format is or whatever, but it''s in as a placeholder';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `GoogleLogin`
--

LOCK TABLES `GoogleLogin` WRITE;
/*!40000 ALTER TABLE `GoogleLogin` DISABLE KEYS */;
/*!40000 ALTER TABLE `GoogleLogin` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `Itinerary`
--

DROP TABLE IF EXISTS `Itinerary`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `Itinerary` (
  `ItineraryID` int NOT NULL AUTO_INCREMENT,
  `ItineraryName` varchar(45) NOT NULL,
  `StartDate` date NOT NULL,
  `EndDate` date NOT NULL,
  `CreatorID` int NOT NULL,
  PRIMARY KEY (`ItineraryID`),
  UNIQUE KEY `Unique_NoDupes` (`ItineraryName`,`StartDate`,`EndDate`,`CreatorID`),
  KEY `FK_ITINERARY_CREATOR_USER_ID_idx` (`CreatorID`),
  CONSTRAINT `FK_ITINERARY_CREATOR_USER_ID` FOREIGN KEY (`CreatorID`) REFERENCES `User` (`UserID`),
  CONSTRAINT `EndDateGreaterThanStartDate` CHECK ((`StartDate` < `EndDate`))
) ENGINE=InnoDB AUTO_INCREMENT=20 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci COMMENT='	';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `Itinerary`
--

LOCK TABLES `Itinerary` WRITE;
/*!40000 ALTER TABLE `Itinerary` DISABLE KEYS */;
INSERT INTO `Itinerary` VALUES (10,'ThirdTest','2020-12-30','2021-12-30',2);
/*!40000 ALTER TABLE `Itinerary` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `NormalLogin`
--

DROP TABLE IF EXISTS `NormalLogin`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `NormalLogin` (
  `UserId` int NOT NULL,
  `HashedPassword` varchar(64) NOT NULL COMMENT 'It''s not hashed. that''s a lie. fix that pls?\n\nShould be stored in encrypted format with private key (symmetric cypher or Private/Public Key, if the DB is doing the decrypting and the API is encrypting. But for now plaintext. security isn''t important anyway.\\n',
  `Email` varchar(45) NOT NULL COMMENT 'needs validation for email',
  PRIMARY KEY (`UserId`),
  UNIQUE KEY `Email_UNIQUE` (`Email`),
  KEY `UserID_idx` (`UserId`),
  CONSTRAINT `FK_USER_ID` FOREIGN KEY (`UserId`) REFERENCES `User` (`UserID`),
  CONSTRAINT `MIN_PW_LENGTH` CHECK ((length(`HashedPassword`) >= 8))
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `NormalLogin`
--

LOCK TABLES `NormalLogin` WRITE;
/*!40000 ALTER TABLE `NormalLogin` DISABLE KEYS */;
INSERT INTO `NormalLogin` VALUES (1,'AbductingWomen','chocolates@thatmakesnosense.edu'),(2,'WeAreGoingOnATrip','ImAwesome@chickenWANG.charlie'),(9,'ShepardImAReaperDoomsdayDevice','abcd@efg.hij'),(11,'adfgdsfgsdfg','randoemail@gmail.com'),(15,';\'kl;\'kl;\'kl;\'','random@email'),(17,'dfghdfghdfghdfghdfg','hdfghdfghdfghdfgh'),(18,'testtest','test@test.com'),(19,'testtest','usertest@email.com'),(20,'wertsdfg','asdfasdf@email.com'),(24,'32412341324123','12341234'),(28,'ricky123','rickjames@gmail.com'),(29,'sdfgsdfgsdfgsd','sdfgsdfg'),(30,'asdasdasda','@sample');
/*!40000 ALTER TABLE `NormalLogin` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `PlannedActivity`
--

DROP TABLE IF EXISTS `PlannedActivity`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `PlannedActivity` (
  `PlannedActivityID` int NOT NULL AUTO_INCREMENT,
  `ActivityName` varchar(45) NOT NULL,
  `StartTime` time NOT NULL,
  `EndTime` time NOT NULL,
  `PlannedDayID` int NOT NULL,
  `ActivityLocation` varchar(45) DEFAULT NULL,
  `ActivityLatitudeCoordinate` decimal(6,4) NOT NULL,
  `ActivityLongitudeCoordinate` decimal(7,4) NOT NULL,
  PRIMARY KEY (`PlannedActivityID`),
  UNIQUE KEY `Unique_NoDupes` (`ActivityName`,`StartTime`,`EndTime`,`PlannedDayID`),
  KEY `FK_PLANNED_DAY_ACTIVITY_idx` (`PlannedDayID`),
  CONSTRAINT `FK_PLANNED_DAY_ACTIVITY` FOREIGN KEY (`PlannedDayID`) REFERENCES `PlannedDay` (`PlannedDayID`),
  CONSTRAINT `EndGreaterThanStart` CHECK ((`StartTime` < `EndTime`)),
  CONSTRAINT `PlannedActivity_chk_1` CHECK (((`ActivityLatitudeCoordinate` < 90) and (`ActivityLatitudeCoordinate` > -(90)))),
  CONSTRAINT `PlannedActivity_chk_2` CHECK (((`ActivityLongitudeCoordinate` < 180) and (`ActivityLongitudeCoordinate` > -(180))))
) ENGINE=InnoDB AUTO_INCREMENT=43 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci COMMENT='To distinquish between an activity that you can do, have done, and have in an itinerary, this is called Planned Activity. If that''s not necessary, great.';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `PlannedActivity`
--

LOCK TABLES `PlannedActivity` WRITE;
/*!40000 ALTER TABLE `PlannedActivity` DISABLE KEYS */;
INSERT INTO `PlannedActivity` VALUES (38,'workples','01:30:00','10:30:00',69,NULL,39.9526,-75.1652),(39,'Repeating Event','00:00:30','00:00:40',71,NULL,0.0000,0.0000),(40,'Repeating Event2','00:00:50','01:00:50',72,NULL,0.0000,0.0000),(41,'Conference','00:01:10','00:01:20',73,NULL,0.0000,0.0000),(42,'Meeting','10:30:00','12:30:00',74,NULL,0.0000,0.0000);
/*!40000 ALTER TABLE `PlannedActivity` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`admin`@`%`*/ /*!50003 TRIGGER `PlannedActivity_BEFORE_INSERT` BEFORE INSERT ON `PlannedActivity` FOR EACH ROW BEGIN
	DECLARE MSG VARCHAR(128);
    
	IF (EXISTS(SELECT Q.PlannedActivityID
	FROM PlannedActivity AS Q INNER JOIN PlannedDay as D ON Q.PlannedDayID = new.PlannedDayID
    WHERE new.StartTime BETWEEN Q.StartTime AND Q.EndTime OR new.EndTime BETWEEN Q.StartTime AND Q.EndTime))
    THEN
		SET MSG = concat('Error: Times overlap', new.startTime);
		SIGNAL sqlstate '45000' SET message_text = MSG;
    END IF;
    
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `PlannedDay`
--

DROP TABLE IF EXISTS `PlannedDay`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `PlannedDay` (
  `PlannedDayID` int NOT NULL AUTO_INCREMENT,
  `CurrentDay` date NOT NULL,
  `ItineraryID` int NOT NULL,
  PRIMARY KEY (`PlannedDayID`),
  UNIQUE KEY `Unique_NoDupes` (`CurrentDay`,`ItineraryID`),
  KEY `FK_IHATEEVERYONE` (`ItineraryID`),
  CONSTRAINT `FK_IHATEEVERYONE` FOREIGN KEY (`ItineraryID`) REFERENCES `Itinerary` (`ItineraryID`)
) ENGINE=InnoDB AUTO_INCREMENT=75 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `PlannedDay`
--

LOCK TABLES `PlannedDay` WRITE;
/*!40000 ALTER TABLE `PlannedDay` DISABLE KEYS */;
INSERT INTO `PlannedDay` VALUES (69,'2021-02-24',10),(71,'2021-09-09',10),(73,'2021-09-11',10),(74,'2021-09-12',10),(72,'2021-09-16',10);
/*!40000 ALTER TABLE `PlannedDay` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `User`
--

DROP TABLE IF EXISTS `User`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `User` (
  `UserID` int NOT NULL AUTO_INCREMENT,
  `ScreenName` varchar(45) NOT NULL,
  `FirstName` varchar(45) DEFAULT NULL,
  `LastName` varchar(45) DEFAULT NULL,
  PRIMARY KEY (`UserID`),
  UNIQUE KEY `ScreenName_UNIQUE` (`ScreenName`)
) ENGINE=InnoDB AUTO_INCREMENT=32 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `User`
--

LOCK TABLES `User` WRITE;
/*!40000 ALTER TABLE `User` DISABLE KEYS */;
INSERT INTO `User` VALUES (1,'DrChocolates','Karen','Chakwas'),(2,'Batman','Bruce','Wayne'),(3,'Superman','Clark','Kent'),(4,'Spiderman','Peter','Parker'),(5,'Report To the Ship...','Commander','Shepard'),(8,'Also Spiderman','Miles','Morales'),(9,'OptimusPrime','Liara','T\'Soni'),(10,'pinche',NULL,NULL),(11,'fsdsfgdgsdfg',NULL,NULL),(12,'what',NULL,NULL),(13,'real',NULL,NULL),(14,'reale',NULL,NULL),(15,'freewilly',NULL,NULL),(16,'freewilly22',NULL,NULL),(17,'gdfhdfghdfghdfgh',NULL,NULL),(18,'tester',NULL,NULL),(19,'usernametest',NULL,NULL),(20,'asdfasdf',NULL,NULL),(21,'test1',NULL,NULL),(23,'username',NULL,NULL),(24,'2134123',NULL,NULL),(25,'meHELLO',NULL,NULL),(26,'meHELLOdgfhdfgh',NULL,NULL),(27,'yoyo',NULL,NULL),(28,'rjames',NULL,NULL),(29,'sdgsdfg',NULL,NULL),(30,'sample',NULL,NULL),(31,'man',NULL,NULL);
/*!40000 ALTER TABLE `User` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Dumping events for database 'database'
--

--
-- Dumping routines for database 'database'
--
/*!50003 DROP FUNCTION IF EXISTS `FN_count_overlaps` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`admin`@`%` FUNCTION `FN_count_overlaps`(s DATE, e DATE) RETURNS int
    DETERMINISTIC
BEGIN
DECLARE ct INT;

SELECT COUNT (Q.PlannedActivityID) INTO ct
	FROM PlannedActivity AS Q 
    WHERE StartTime BETWEEN Q.StartTime AND Q.EndTime OR EndTime BETWEEN Q.StartTime AND Q.EndTime;
RETURN ct;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `ActivityCreate` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`admin`@`%` PROCEDURE `ActivityCreate`(IN SourceItineraryID INT, IN title VARCHAR(45), IN dayOccurs DATE, IN beginTime TIME(0), IN stopTime TIME(0))
BEGIN
	DECLARE dayID INT;
    
	INSERT IGNORE INTO PlannedDay (CurrentDay, ItineraryID)
    VALUE (dayOccurs, SourceItineraryID);

    SELECT PlannedDayID INTO dayID FROM PlannedDay As PD WHERE PD.CurrentDay = dayOccurs AND PD.ItineraryId = SourceItineraryID;
    
	INSERT INTO PlannedActivity
    (ActivityName, StartTime, EndTime, PlannedDayID)
    VALUE (title, beginTime, stopTime, dayID);
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `CreateItinerary` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`admin`@`%` PROCEDURE `CreateItinerary`(IN title VARCHAR(45), IN firstDay DATE, IN lastDay DATE, IN creator INT)
BEGIN
	INSERT INTO Itinerary 
    (ItineraryName, StartDate, EndDate, CreatorID)
    VALUE (title, firstDay, lastDay, creator);
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `CreateUserNormalLogin` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`admin`@`%` PROCEDURE `CreateUserNormalLogin`(screen varchar(45), email varchar(45), pass varchar(64), out success bool)
BEGIN
DECLARE temp INT;
IF (NOT Exists(SELECT U.ScreenName FROM User AS U WHERE U.ScreenName = screen)) 
THEN
	INSERT INTO User (ScreenName)
    VALUE(screen);
    SELECT K.UserID INTO temp FROM User as K WHERE K.ScreenName = screen;
    
    Insert Into NormalLogin (UserID, Email, HashedPassword)
    VALUE (temp, email, pass);
    
	set success = true;
ELSE
	set success = false;
END IF;

END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `FindUser` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`admin`@`%` PROCEDURE `FindUser`(IN screen VARCHAR(45))
BEGIN
	SELECT * FROM `User` WHERE `User`.ScreenName LIKE screen;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `FindUsers` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`admin`@`%` PROCEDURE `FindUsers`(IN screen VARCHAR(45))
BEGIN
	SELECT  `UserID`, `ScreenName`, `FirstName`, `LastName`,
    (`ScreenName` LIKE screen) AS IsExactMatch
    FROM `User` WHERE `ScreenName` LIKE CONCAT('%', screen, '%')
    ORDER BY IsExactMatch DESC;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetAllItineraryInformation` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`admin`@`%` PROCEDURE `GetAllItineraryInformation`(IN UserID int)
BEGIN
 SELECT 
        `I`.`ItineraryName` AS `ItineraryName`,
        `I`.`StartDate` AS `StartDate`,
        `I`.`EndDate` AS `EndDate`,
        `D`.`CurrentDay` AS `CurrentDay`,
        `A`.`ActivityName` AS `ActivityName`,
        `A`.`StartTime` AS `StartTime`,
        `A`.`EndTime` AS `EndTime`
    FROM
        ((`Itinerary` `I`
        LEFT JOIN `PlannedDay` `D` ON ((`I`.`ItineraryID` = `D`.`ItineraryID`)))
        LEFT JOIN `PlannedActivity` `A` ON ((`D`.`PlannedDayID` = `A`.`PlannedDayID`)))
	WHERE I.CreatorID = UserID;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetItineraryInformation2` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`admin`@`%` PROCEDURE `GetItineraryInformation2`(UserID int)
BEGIN
	SELECT 
        `D`.`CurrentDay` AS `CurrentDay`,
        `A`.`ActivityName` AS `ActivityName`,
        `A`.`StartTime` AS `StartTime`,
        `A`.`EndTime` AS `EndTime`
    FROM
        ((`Itinerary` `I`
        LEFT JOIN `PlannedDay` `D` ON ((`I`.`ItineraryID` = `D`.`ItineraryID`)))
        LEFT JOIN `PlannedActivity` `A` ON ((`D`.`PlannedDayID` = `A`.`PlannedDayID`)))
	WHERE I.CreatorID = UserID;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetItineraryInformationNoActivities` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`admin`@`%` PROCEDURE `GetItineraryInformationNoActivities`(UserID int)
BEGIN
	SELECT 
        `D`.`CurrentDay` AS `CurrentDay`,
        `A`.`ActivityName` AS `ActivityName`,
        `A`.`StartTime` AS `StartTime`,
        `A`.`EndTime` AS `EndTime`
    FROM
        ((`Itinerary` `I`
        LEFT JOIN `PlannedDay` `D` ON ((`I`.`ItineraryID` = `D`.`ItineraryID`)))
        LEFT JOIN `PlannedActivity` `A` ON ((`D`.`PlannedDayID` = `A`.`PlannedDayID`)))
	WHERE I.CreatorID = UserID;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `ItinerariesIncludingGivenCoordinates` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`admin`@`%` PROCEDURE `ItinerariesIncludingGivenCoordinates`(IN LatCoordinate Decimal(6,4), IN LongCoordinate Decimal(7,4), IN DistanceAwayInMiles DOUBLE)
BEGIN
	SELECT 
        `I`.`ItineraryName` AS `ItineraryName`,
        `I`.`StartDate` AS `StartDate`,
        `I`.`EndDate` AS `EndDate`,
        `D`.`CurrentDay` AS `CurrentDay`,
        `A`.`ActivityName` AS `ActivityName`,
        `A`.`ActivityLatitudeCoordinate` AS `Latitude`,
        `A`.`ActivityLongitudeCoordinate` AS `Longitude`,
        `A`.`StartTime` AS `StartTime`,
        `A`.`EndTime` AS `EndTime`,
        (
			3959 * acos (
			cos ( radians(LatCoordinate) )
			* cos( radians(  `A`.`ActivityLatitudeCoordinate` ) )
			* cos( radians( `A`.`ActivityLongitudeCoordinate` ) - radians(LongCoordinate) )
			+ sin ( radians(LatCoordinate) )
			* sin( radians( `A`.`ActivityLatitudeCoordinate`) )
		)) AS `DistanceAway`
    FROM
        ((`Itinerary` `I`
        INNER JOIN `PlannedDay` `D` ON ((`I`.`ItineraryID` = `D`.`ItineraryID`)))
        INNER JOIN `PlannedActivity` `A` ON ((`D`.`PlannedDayID` = `A`.`PlannedDayID`)))
	 Having 
		`DistanceAway` <= DistanceAwayInMiles
		;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `TryLoginGetID` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`admin`@`%` PROCEDURE `TryLoginGetID`(IN email VARCHAR(45), IN pass VARCHAR(64), OUT id INT)
BEGIN
    SELECT K.UserID INTO id FROM NormalLogin as K WHERE K.Email = email AND K.HashedPassword = pass;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Final view structure for view `DefaultUIView`
--

/*!50001 DROP VIEW IF EXISTS `DefaultUIView`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`admin`@`%` SQL SECURITY DEFINER */
/*!50001 VIEW `DefaultUIView` AS select `I`.`ItineraryName` AS `ItineraryName`,`I`.`StartDate` AS `StartDate`,`I`.`EndDate` AS `EndDate`,`D`.`CurrentDay` AS `CurrentDay`,`A`.`ActivityName` AS `ActivityName`,`A`.`StartTime` AS `StartTime`,`A`.`EndTime` AS `EndTime` from ((`Itinerary` `I` left join `PlannedDay` `D` on((`I`.`ItineraryID` = `D`.`ItineraryID`))) left join `PlannedActivity` `A` on((`D`.`PlannedDayID` = `A`.`PlannedDayID`))) */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;
SET @@SESSION.SQL_LOG_BIN = @MYSQLDUMP_TEMP_LOG_BIN;
/*!40103 SET TIME_ZONE=@OLD_TIME_ZONE */;

/*!40101 SET SQL_MODE=@OLD_SQL_MODE */;
/*!40014 SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS */;
/*!40014 SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS */;
/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */;
/*!40101 SET CHARACTER_SET_RESULTS=@OLD_CHARACTER_SET_RESULTS */;
/*!40101 SET COLLATION_CONNECTION=@OLD_COLLATION_CONNECTION */;
/*!40111 SET SQL_NOTES=@OLD_SQL_NOTES */;

-- Dump completed on 2021-10-25 10:13:50
